{% extends "base.html" %}
{% block title %}Characters{% endblock %}

{% block content %}
<h1>Characters</h1>

{% if characters %}
<table class="char-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Class</th>
            <th>Race</th>

            {% if request.endpoint == 'main.public_characters' %}
                <th>Owner</th>
                <th>Copy</th>

            {% elif request.endpoint == 'main.my_characters' %}
                <th>Visibility</th>
                <th>Edit</th>
                <th>Delete</th>
            {% endif %}

            <th>View</th>
        </tr>
    </thead>

    <tbody>
        {% for character in characters %}
        <tr>
            <td>{{ character.name }}</td>
            <td>{{ character.character_class }}</td>
            <td>{{ character.race }}</td>

            {% if request.endpoint == 'main.public_characters' %}
                <td>{{ character.owner.username }}</td>

                <td>
                    {% if character.owner_id != current_user.id %}
                    <form action="{{ url_for('main.copy_character', char_id=character.id) }}" method="POST">
                        <button type="submit" class="btn">Copy</button>
                    </form>
                    {% else %}
                        <span style="opacity:0.5;">Owned</span>
                    {% endif %}
                </td>

            {% elif request.endpoint == 'main.my_characters' %}
                <td>{% if character.is_public %}Public{% else %}Private{% endif %}</td>

                <td>
                    <a class="btn" href="{{ url_for('main.edit_character', character_id=character.id) }}">Edit</a>
                </td>

                <td>
                    <form action="{{ url_for('main.delete_character', character_id=character.id) }}" method="POST"
                          onsubmit="return confirm('Are you sure you want to delete this character? This cannot be undone.');">
                        <button type="submit" class="btn danger-btn">Delete</button>
                    </form>
                </td>
            {% endif %}

            <td>
                <a class="btn" href="{{ url_for('main.character_detail', char_id=character.id) }}">
                    View
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}
<p>No characters found.</p>
{% endif %}

<br>

<a href="{{ url_for('main.dashboard') }}" class="btn">Back to Dashboard</a>

{% endblock %}
